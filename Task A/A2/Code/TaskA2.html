<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  	<script src="/d3.v3.min.js"></script>
  	<script src="/dimple.v2.1.2.min.js"></script>
    <style>
    body {
      margin: 50px;
    }
    </style>
 </head>
 <body>
	<div id="chartContainer1">
		<h1>Total Sales Across All Stores (Pie chart)</h1>
	
		<script>
			// 读取CSV数据并绘制图表
			d3.csv("Walmart_Store_sales.csv", function(data) {
				// 创建画布
				var svg = dimple.newSvg("#chartContainer1", 1000, 800);
	
				// 创建图表
				var chart = new dimple.chart(svg, data);
	
				// 设置标签和数值字段
				var pie = chart.addMeasureAxis("p", "Weekly_Sales");
	
				// 添加饼图
				var slices = chart.addSeries("Store", dimple.plot.pie);
					
				// 添加图例
				var legend = chart.addLegend(60, 10, 700, 20, "right");
				legend.fontSize = "12px";
	
				// 渲染图表
				chart.draw();
			});
		</script>
	</div>	

	<div id="chartContainer2">
		<h1>Store 1 Sales - Temperature (Scatter Plot)</h1>

		<script>
			// Load data from CSV
			d3.csv("Walmart_Store_sales.csv", function(data) {
				// Filter data for Store 1
				var store1Data = data.filter(function(d) {
					return d.Store === "1";
				});
		
				// Create a new dimple chart
				var svg = dimple.newSvg("#chartContainer2", 1800, 600);
		
				// Define chart
				var chart = new dimple.chart(svg, store1Data);
		
				// Set x-axis as Temperature and sort it
				var x = chart.addCategoryAxis("x", "Temperature");
				x.addOrderRule("Temperature");
			
				// Set y-axis as Weekly_sales
				var y = chart.addMeasureAxis("y", "Weekly_Sales");
			
				// Add scatter plot
				chart.addSeries(null, dimple.plot.scatter);
			
				// Draw chart
				chart.draw();
			});
		  </script>
	</div>

	<div id="chartContainer3">
		<h1>Average Fuel Price For Each Store In The Area (Bar Chart)</h1>

		<script>
			// 读取CSV数据并绘制图表
			d3.csv("Walmart_Store_sales.csv", function(data) {
			// 使用D3.js进行数据处理，计算每个商店该地区Fuel_Price的平均值
			var groupedData = d3.nest()
								.key(function(d) { return d.Store; })
								.rollup(function(v) { 
								return d3.mean(v, function(d) { return d.Fuel_Price; }); 
								})
								.entries(data);

			// 将处理后的数据转换为Dimple.js所需的格式
			var formattedData = groupedData.map(function(d) {
				return {
				Store: d.key,
				Average_Fuel_Price: d.values
				};
			});

			// 创建画布
			var svg = dimple.newSvg("#chartContainer3", 800, 600);

			// 创建图表
			var chart = new dimple.chart(svg, formattedData);

			// 设置横轴
			var x = chart.addCategoryAxis("x", "Store");

			// 设置纵轴
			var y = chart.addMeasureAxis("y", "Average_Fuel_Price");
			y.overrideMin = 0; // 确保销售额的最小值为0

			// 添加柱形图
			var bars = chart.addSeries(null, dimple.plot.bar);

			// 渲染图表
			chart.draw();
			});
		</script>
	</div>

 </body>
 </html>
